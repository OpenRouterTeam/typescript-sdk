/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

import dotenv from "dotenv";

dotenv.config();

/**
 * Example usage of the @openrouter/sdk SDK for chat completions
 *
 * To run this example from the examples directory with Bun:
 * bun run chatCompletions.example.ts
 */

import { OpenRouter } from "../src/index.js";

if (!process.env["OPENROUTER_API_KEY"]) {
  throw new Error("Missing OPENROUTER_API_KEY environment variable");
}
const openRouter = new OpenRouter({
  apiKey: process.env["OPENROUTER_API_KEY"] ?? "",
  debugLogger: console,
});

async function nonStreamingExample() {
  const result = await openRouter.chat.send({
    model: "qwen/qwen3-max",
    messages: [
      {
        role: "user",
        content: "Tell me a short joke about programming",
      },
    ],
    stream: false,
  });

  if ("choices" in result) {
    console.log(result.choices[0].message.content);
  }
}

async function streamingExample() {
  const result = await openRouter.chat.send({
    model: "qwen/qwen3-max",
    messages: [
      {
        role: "user",
        content: "Write a haiku about TypeScript",
      },
    ],
    stream: true,
    streamOptions: {
      includeUsage: true,
    },
  });

  if (result && typeof result === "object" && Symbol.asyncIterator in result) {
    const stream = result;
    let _fullContent = "";

    for await (const chunk of stream) {
      if (chunk.choices?.[0]?.delta?.content) {
        const content = chunk.choices[0].delta.content;
        process.stdout.write(content);
        _fullContent += content;
      }

      if (chunk.usage) {
        console.log(chunk.usage);
      }
    }
  }
}

async function main() {
  try {
    await nonStreamingExample();
    await streamingExample();
  } catch (_error) {
    console.error(_error);
  }
}

main();
